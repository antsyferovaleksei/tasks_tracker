import{j as e,B as t,U as s,g as i,m as a,W as r,X as n,h as l,Y as o,Z as d,$ as c,O as h,a0 as u,e as j,a1 as x,a2 as p,a3 as m,F as g,s as v,a4 as y,a5 as f,a6 as I,a7 as k,I as C,a8 as b,a9 as T,n as S,K as D,aa as O,r as W,ab as w,ac as M,ad as E,ae as P,af as A,ag as L,ah as $,ai as U}from"./mui-56a233f4.js";import{u as z,r as R,b as H}from"./vendor-2c736f18.js";import{e as G,f as N,c as q,g as K,h as _,i as B,j as F,k as X,l as Y,m as Z}from"./index-f084df4f.js";import{g as J,a as Q,b as V}from"./index-2d5a8536.js";import"./utils-18e1ec00.js";const ee=e=>{if(!e)return"0m";const t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=e%60;return t>0?`${t}h ${s}m`:s>0?`${s}m ${i}s`:`${i}s`},te=({onStopTimer:s})=>{const{activeTimer:r}=q(),n=X(),[l,o]=R.useState(0);if(H.useEffect((()=>{if(r){const e=()=>{const e=Math.floor((Date.now()-new Date(r.startTime).getTime())/1e3);o(e)};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}}),[r]),!r)return null;return e.jsxs(j,{elevation:3,sx:{p:2,mb:3,backgroundColor:"primary.main",color:"primary.contrastText",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(t,{display:"flex",alignItems:"center",gap:2,children:[e.jsx($,{}),e.jsxs(t,{children:[e.jsx(i,{variant:"subtitle1",fontWeight:"bold",children:r.task?.title}),e.jsx(i,{variant:"h5",fontWeight:"bold",children:ee(l)})]})]}),e.jsx(a,{variant:"contained",color:"secondary",startIcon:e.jsx(O,{}),onClick:()=>{s?s():n.mutate(r.id)},disabled:n.isPending,children:"Stop"})]})},se=({taskId:s})=>{const{data:a}=Z(s);return a?.success&&a.data?.totalTime?e.jsxs(t,{display:"flex",alignItems:"center",gap:1,mt:1,children:[e.jsx(U,{fontSize:"small",color:"action"}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["Spent: ",ee(a.data.totalTime)]})]}):null};function ie(){const $=z(),[U,H]=R.useState({status:void 0,priority:void 0,search:""}),[Z,ee]=R.useState(U.search||""),[ie,ae]=R.useState(!1),[re,ne]=R.useState(!1),[le,oe]=R.useState(null),[de,ce]=R.useState(null),[he,ue]=R.useState({title:"",description:"",priority:"MEDIUM",status:"TODO",archived:!1,projectId:""}),[je,xe]=R.useState({description:"",duration:"",startTime:(new Date).toISOString().slice(0,16)}),[pe,me]=R.useState({}),{tasks:ge=[],isLoading:ve}=G(U),ye=Array.isArray(ge)?ge:[],{projects:fe=[],isLoading:Ie}=N(),{activeTimer:ke}=q(),Ce=K(),be=_(),Te=B(),Se=F(),De=X(),Oe=Y(),We=R.useMemo((()=>{const e={};return ye.forEach((t=>{const s=t.projectId||"no-project";if(!e[s]){const t="no-project"===s?null:fe.find((e=>e.id===s))||null;e[s]={project:t,tasks:[]}}e[s].tasks.push(t)})),e}),[ye,fe]),we=()=>{const e={};return he.title.trim()||(e.title="Task title is required"),he.projectId||(e.projectId="Please select a project for the task"),me(e),0===Object.keys(e).length},Me=()=>{ke&&De.mutate(ke.id,{onSuccess:()=>{ke.task&&"COMPLETED"!==ke.task.status&&be.mutate({id:ke.task.id,data:{...ke.task,status:"COMPLETED"}})}})};return ve||Ie?e.jsxs(t,{display:"flex",justifyContent:"center",p:4,children:[e.jsx(s,{}),e.jsx(i,{ml:2,children:"Loading..."})]}):e.jsxs(t,{p:3,children:[e.jsx(te,{onStopTimer:Me}),e.jsxs(t,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(i,{variant:"h4",component:"h1",children:"Tasks"}),e.jsx(a,{variant:"contained",startIcon:e.jsx(r,{}),onClick:()=>{if(0===fe.length)return;const e=[...fe].sort(((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()))[0];ue((t=>({...t,projectId:e?.id||""}))),ae(!0)},children:"Add Task"})]}),0===fe.length&&e.jsx(n,{severity:"warning",sx:{mb:3},action:e.jsx(a,{color:"inherit",size:"small",onClick:()=>$("/projects"),children:"Create Project"}),children:"To create tasks, you need to create at least one project first."}),e.jsxs(t,{mb:3,display:"flex",gap:2,flexWrap:"wrap",alignItems:"flex-end",children:[e.jsx(l,{placeholder:"Search tasks...",value:Z,onChange:e=>{const t=e.target.value;ee(t),""===t&&U.search&&H({...U,search:""})},onKeyPress:e=>{"Enter"===e.key&&(()=>{const e={...U,search:Z};H(e)})()},sx:{minWidth:200}}),e.jsxs(o,{sx:{minWidth:120},children:[e.jsx(d,{children:"Project"}),e.jsxs(c,{value:U.projectId||"",onChange:e=>H({...U,projectId:e.target.value||void 0}),children:[e.jsx(h,{value:"",children:"All projects"}),fe.map((t=>e.jsx(h,{value:t.id,children:t.name},t.id)))]})]}),e.jsxs(o,{sx:{minWidth:120},children:[e.jsx(d,{children:"Status"}),e.jsxs(c,{value:Array.isArray(U.status)?U.status[0]||"":U.status||"",onChange:e=>{const t=e.target.value;H({...U,status:t?[t]:void 0})},children:[e.jsx(h,{value:"",children:"All"}),e.jsx(h,{value:"TODO",children:"To Do"}),e.jsx(h,{value:"IN_PROGRESS",children:"In Progress"}),e.jsx(h,{value:"COMPLETED",children:"Completed"})]})]}),e.jsxs(o,{sx:{minWidth:120},children:[e.jsx(d,{children:"Priority"}),e.jsxs(c,{value:Array.isArray(U.priority)?U.priority[0]||"":U.priority||"",onChange:e=>{const t=e.target.value;H({...U,priority:t?[t]:void 0})},children:[e.jsx(h,{value:"",children:"All"}),e.jsx(h,{value:"LOW",children:"Low"}),e.jsx(h,{value:"MEDIUM",children:"Medium"}),e.jsx(h,{value:"HIGH",children:"High"})]})]}),!!(Z||U.search||U.projectId||U.status&&U.status.length>0||U.priority&&U.priority.length>0)&&e.jsx(a,{variant:"outlined",startIcon:e.jsx(u,{}),onClick:()=>{ee(""),H({status:void 0,priority:void 0,search:"",projectId:void 0})},sx:{height:"56px"},children:"Clear filters"})]}),0===Object.keys(We).length?e.jsx(t,{textAlign:"center",py:4,children:e.jsx(i,{variant:"h6",color:"text.secondary",children:0===fe.length?"Create a project to get started":"No tasks found"})}):Object.entries(We).map((([s,{project:a,tasks:r}])=>e.jsx(j,{sx:{mb:2},children:e.jsxs(x,{defaultExpanded:!0,children:[e.jsx(p,{expandIcon:e.jsx(m,{}),sx:{backgroundColor:a?.color?`${a.color}20`:"transparent","&:hover":{backgroundColor:a?.color?`${a.color}30`:"action.hover"}},children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(g,{sx:{color:a?.color||"text.secondary"}}),e.jsx(i,{variant:"h6",children:a?.name||"No project"}),e.jsx(v,{label:`${r.length} tasks`,size:"small",variant:"outlined"})]})}),e.jsx(y,{children:e.jsx(f,{container:!0,spacing:2,children:r.map((s=>{const a=ke?.taskId===s.id;return e.jsx(f,{item:!0,xs:12,sm:6,md:4,children:e.jsx(I,{variant:"outlined",children:e.jsxs(k,{children:[e.jsxs(t,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[e.jsx(i,{variant:"h6",component:"h3",children:s.title}),e.jsxs(t,{children:[e.jsx(C,{size:"small",onClick:()=>(e=>{ce(e),ue({title:e.title,description:e.description||"",priority:e.priority,status:e.status,archived:e.archived,projectId:e.projectId||""}),me({}),ae(!0)})(s),children:e.jsx(b,{})}),e.jsx(C,{size:"small",onClick:()=>{return e=s.id,void(window.confirm("Are you sure you want to delete this task?")&&Te.mutate(e));var e},color:"error",children:e.jsx(T,{})})]})]}),s.description&&e.jsx(i,{variant:"body2",color:"text.secondary",mb:2,children:s.description}),e.jsxs(t,{display:"flex",gap:1,mb:2,children:[e.jsx(v,{label:s.status,size:"small",color:J(s.status)}),e.jsx(v,{label:s.priority,size:"small",color:Q(s.priority)})]}),e.jsx(se,{taskId:s.id}),e.jsx(S,{sx:{my:1}}),e.jsxs(t,{display:"flex",gap:1,mt:2,children:[a?e.jsx(D,{title:"Stop timer",children:e.jsx(C,{color:"error",onClick:Me,disabled:De.isPending,children:e.jsx(O,{})})}):e.jsx(D,{title:"Start timer",children:e.jsx(C,{color:"primary",onClick:()=>(e=>{Se.mutate({taskId:e.id,description:`Working on task: ${e.title}`})})(s),disabled:!!ke||Se.isPending,children:e.jsx(W,{})})}),e.jsx(D,{title:"Add time manually",children:e.jsx(C,{color:"secondary",onClick:()=>(e=>{oe(e),xe({description:"",duration:"",startTime:(new Date).toISOString().slice(0,16)}),ne(!0)})(s),children:e.jsx(w,{})})})]}),s.createdAt&&e.jsxs(i,{variant:"caption",color:"text.secondary",display:"block",mt:1,children:["Створено: ",V(s.createdAt)]})]})})},s.id)}))})})]})},s))),e.jsxs(M,{open:ie,onClose:()=>ae(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(E,{children:de?"Edit task":"Create task"}),e.jsx(P,{children:e.jsxs(t,{display:"flex",flexDirection:"column",gap:2,pt:1,children:[e.jsxs(o,{fullWidth:!0,error:!!pe.projectId,children:[e.jsx(d,{children:"Project *"}),e.jsx(c,{value:he.projectId,onChange:e=>{ue({...he,projectId:e.target.value}),pe.projectId&&me((e=>({...e,projectId:""})))},required:!0,children:fe.map((s=>e.jsx(h,{value:s.id,children:e.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(t,{width:12,height:12,borderRadius:"50%",bgcolor:s.color}),s.name]})},s.id)))}),pe.projectId&&e.jsx(A,{children:pe.projectId})]}),e.jsx(l,{label:"Task name *",value:he.title,onChange:e=>{ue({...he,title:e.target.value}),pe.title&&me((e=>({...e,title:""})))},required:!0,fullWidth:!0,error:!!pe.title,helperText:pe.title}),e.jsx(l,{label:"Description",value:he.description,onChange:e=>ue({...he,description:e.target.value}),multiline:!0,rows:3,fullWidth:!0}),e.jsxs(o,{fullWidth:!0,children:[e.jsx(d,{children:"Priority"}),e.jsxs(c,{value:he.priority,onChange:e=>ue({...he,priority:e.target.value}),children:[e.jsx(h,{value:"LOW",children:"Low"}),e.jsx(h,{value:"MEDIUM",children:"Medium"}),e.jsx(h,{value:"HIGH",children:"High"}),e.jsx(h,{value:"URGENT",children:"Urgent"})]})]}),e.jsxs(o,{fullWidth:!0,children:[e.jsx(d,{children:"Status"}),e.jsxs(c,{value:he.status,onChange:e=>ue({...he,status:e.target.value}),children:[e.jsx(h,{value:"TODO",children:"To Do"}),e.jsx(h,{value:"IN_PROGRESS",children:"In Progress"}),e.jsx(h,{value:"COMPLETED",children:"Completed"})]})]})]})}),e.jsxs(L,{children:[e.jsx(a,{onClick:()=>{ae(!1),ce(null),ue({title:"",description:"",priority:"MEDIUM",status:"TODO",archived:!1,projectId:""}),me({})},children:"Cancel"}),e.jsx(a,{onClick:de?()=>{we()&&de&&be.mutate({id:de.id,data:he},{onSuccess:()=>{ae(!1),ce(null),ue({title:"",description:"",priority:"MEDIUM",status:"TODO",archived:!1,projectId:""}),me({})}})}:()=>{we()&&Ce.mutate(he,{onSuccess:()=>{ae(!1),ue({title:"",description:"",priority:"MEDIUM",status:"TODO",archived:!1,projectId:""}),me({})}})},variant:"contained",disabled:!he.title||!he.projectId,children:de?"Update":"Create"})]})]}),e.jsxs(M,{open:re,onClose:()=>ne(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsxs(E,{children:["Add час для: ",le?.title]}),e.jsx(P,{children:e.jsxs(t,{display:"flex",flexDirection:"column",gap:2,pt:1,children:[e.jsx(l,{label:"Description of work",value:je.description,onChange:e=>xe({...je,description:e.target.value}),fullWidth:!0,placeholder:"What did you do..."}),e.jsx(l,{label:"Duration (minutes) *",type:"number",value:je.duration,onChange:e=>xe({...je,duration:e.target.value}),required:!0,fullWidth:!0,inputProps:{step:1},helperText:"Positive values add time, negative values subtract time from task"}),e.jsx(l,{label:"Time start",type:"datetime-local",value:je.startTime,onChange:e=>xe({...je,startTime:e.target.value}),fullWidth:!0,InputLabelProps:{shrink:!0}})]})}),e.jsxs(L,{children:[e.jsx(a,{onClick:()=>ne(!1),children:"Cancel"}),e.jsx(a,{onClick:()=>{if(!le||!je.duration)return;const e=parseInt(je.duration),t=60*e,s=new Date(je.startTime),i=t>0?new Date(s.getTime()+1e3*t):new Date(s.getTime()),a=e<0?je.description||`Subtracted ${Math.abs(e)} minutes`:je.description||`Added ${e} minutes`;Oe.mutate({taskId:le.id,description:a,startTime:s.toISOString(),endTime:i.toISOString(),duration:t,isRunning:!1},{onSuccess:()=>{ne(!1),oe(null),xe({description:"",duration:"",startTime:(new Date).toISOString().slice(0,16)})}})},variant:"contained",disabled:!je.duration||Oe.isPending,children:"Add"})]})]})]})}export{ie as default};
