import{j as s,B as e,U as a,g as n,a5 as r,a6 as i,a7 as t,z as d,p as l,E as o,al as c,m,a8 as x,k as h,q as j,ah as u,am as v,an as w,ac as g,ad as p,ae as P,h as f,ag as b}from"./mui-56a233f4.js";import{r as y}from"./vendor-2c736f18.js";import{u as C,q as k,s as S,t as T}from"./index-884950cc.js";import{b as A,f as W}from"./index-2d5a8536.js";import"./utils-18e1ec00.js";function z(){const{user:z}=C(),{data:E,isLoading:F}=k(30),I=S(),M=T(),[N,R]=y.useState(!1),[q,U]=y.useState(!1),[B,D]=y.useState({name:z?.name||"",email:z?.email||""}),[H,L]=y.useState({currentPassword:"",newPassword:"",confirmPassword:""});if(F)return s.jsx(e,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh",children:s.jsx(a,{})});const G=E?.data?.summary,J=G&&G.completedTasks>0?Math.floor(G.totalTimeSpent/G.completedTasks):0,K=Math.ceil((G?.completedTasks||0)/4)||0;return s.jsxs(e,{p:3,children:[s.jsx(n,{variant:"h4",component:"h1",mb:3,children:"User Profile"}),s.jsxs(r,{container:!0,spacing:3,children:[s.jsx(r,{item:!0,xs:12,md:4,children:s.jsx(i,{children:s.jsxs(t,{sx:{textAlign:"center"},children:[s.jsx(d,{sx:{width:100,height:100,mx:"auto",mb:2},src:z?.avatar,children:s.jsx(l,{sx:{fontSize:50}})}),s.jsx(n,{variant:"h5",mb:1,children:z?.name||"Користувач"}),s.jsxs(n,{variant:"body2",color:"text.secondary",mb:1,children:[s.jsx(o,{sx:{fontSize:16,mr:1,verticalAlign:"middle"}}),z?.email]}),s.jsxs(n,{variant:"body2",color:"text.secondary",mb:2,children:[s.jsx(c,{sx:{fontSize:16,mr:1,verticalAlign:"middle"}}),"Registration: ",z?.createdAt?A(z.createdAt):"Невідомо"]}),s.jsx(m,{variant:"outlined",startIcon:s.jsx(x,{}),onClick:()=>{D({name:z?.name||"",email:z?.email||""}),R(!0)},sx:{mb:1,width:"100%"},children:"Edit profile"}),s.jsx(m,{variant:"outlined",startIcon:s.jsx(h,{}),onClick:()=>U(!0),sx:{width:"100%"},children:"Change Password"})]})})}),s.jsx(r,{item:!0,xs:12,md:8,children:s.jsxs(r,{container:!0,spacing:2,children:[s.jsx(r,{item:!0,xs:12,sm:6,md:3,children:s.jsx(i,{children:s.jsxs(t,{children:[s.jsxs(n,{variant:"h6",color:"primary",children:[s.jsx(j,{sx:{mr:1,verticalAlign:"middle"}}),G?.totalTasks||0]}),s.jsx(n,{variant:"body2",color:"text.secondary",children:"All tasks"})]})})}),s.jsx(r,{item:!0,xs:12,sm:6,md:3,children:s.jsx(i,{children:s.jsxs(t,{children:[s.jsx(n,{variant:"h6",color:"success.main",children:G?.completedTasks||0}),s.jsx(n,{variant:"body2",color:"text.secondary",children:"Completed"})]})})}),s.jsx(r,{item:!0,xs:12,sm:6,md:3,children:s.jsx(i,{children:s.jsxs(t,{children:[s.jsx(n,{variant:"h6",color:"info.main",children:G?.inProgressTasks||0}),s.jsx(n,{variant:"body2",color:"text.secondary",children:"In Progress"})]})})}),s.jsx(r,{item:!0,xs:12,sm:6,md:3,children:s.jsx(i,{children:s.jsxs(t,{children:[s.jsxs(n,{variant:"h6",color:"warning.main",children:[s.jsx(u,{sx:{mr:1,verticalAlign:"middle"}}),W(G?.totalTimeSpent||0)]}),s.jsx(n,{variant:"body2",color:"text.secondary",children:"Total time"})]})})}),s.jsx(r,{item:!0,xs:12,children:s.jsx(i,{children:s.jsxs(t,{children:[s.jsxs(n,{variant:"h6",mb:2,children:[s.jsx(v,{sx:{mr:1,verticalAlign:"middle"}}),"Detailed statistic"]}),s.jsxs(r,{container:!0,spacing:2,children:[s.jsxs(r,{item:!0,xs:12,sm:6,children:[s.jsx(n,{variant:"body2",mb:1,children:"Tasks progress"}),s.jsx(w,{variant:"determinate",value:parseFloat(G?.completionRate||"0"),sx:{mb:1}}),s.jsxs(n,{variant:"body2",color:"text.secondary",children:[Math.round(parseFloat(G?.completionRate||"0")),"% completed"]})]}),s.jsxs(r,{item:!0,xs:12,sm:6,children:[s.jsxs(n,{variant:"body2",children:["📊 Medium time for a task: ",W(J)]}),s.jsxs(n,{variant:"body2",children:["📅 Tasks durng the week: ~",K]}),s.jsxs(n,{variant:"body2",children:["🏢 Projects: ",G?.projectsCount||0]})]})]}),G&&G.overdueTasks>0&&s.jsx(e,{mt:2,children:s.jsxs(n,{variant:"body2",color:"error",children:["⚠️ Прострочено tasks: ",G.overdueTasks]})})]})})})]})})]}),s.jsxs(g,{open:N,onClose:()=>R(!1),maxWidth:"sm",fullWidth:!0,children:[s.jsx(p,{children:"Edit profile"}),s.jsxs(P,{children:[s.jsx(f,{autoFocus:!0,margin:"dense",label:"Ім'я",fullWidth:!0,variant:"outlined",value:B.name,onChange:s=>D((e=>({...e,name:s.target.value}))),sx:{mb:2}}),s.jsx(f,{margin:"dense",label:"Email",type:"email",fullWidth:!0,variant:"outlined",value:B.email,onChange:s=>D((e=>({...e,email:s.target.value})))})]}),s.jsxs(b,{children:[s.jsx(m,{onClick:()=>R(!1),children:"Cancel"}),s.jsx(m,{onClick:()=>{B.name.trim()&&I.mutate({name:B.name,email:B.email},{onSuccess:()=>{R(!1)}})},variant:"contained",disabled:I.isPending,children:I.isPending?"Saving...":"Save"})]})]}),s.jsxs(g,{open:q,onClose:()=>U(!1),maxWidth:"sm",fullWidth:!0,children:[s.jsx(p,{children:"Change Password"}),s.jsxs(P,{children:[s.jsx(f,{autoFocus:!0,margin:"dense",label:"Current Password",type:"password",fullWidth:!0,variant:"outlined",value:H.currentPassword,onChange:s=>L((e=>({...e,currentPassword:s.target.value}))),sx:{mb:2}}),s.jsx(f,{margin:"dense",label:"New Password",type:"password",fullWidth:!0,variant:"outlined",value:H.newPassword,onChange:s=>L((e=>({...e,newPassword:s.target.value}))),sx:{mb:2}}),s.jsx(f,{margin:"dense",label:"Confirm new password",type:"password",fullWidth:!0,variant:"outlined",value:H.confirmPassword,onChange:s=>L((e=>({...e,confirmPassword:s.target.value})))})]}),s.jsxs(b,{children:[s.jsx(m,{onClick:()=>U(!1),children:"Cancel"}),s.jsx(m,{onClick:()=>{H.currentPassword&&H.newPassword&&(H.newPassword===H.confirmPassword?H.newPassword.length<6?alert("New Password must have at least 6 characters"):M.mutate({currentPassword:H.currentPassword,newPassword:H.newPassword},{onSuccess:()=>{U(!1),L({currentPassword:"",newPassword:"",confirmPassword:""})}}):alert("New Password and confirmation are not the same"))},variant:"contained",disabled:M.isPending,children:M.isPending?"Change...":"Change Password"})]})]})]})}export{z as default};
